{% extends 'base.html' %}

{% block content %}
<div class="max-w-[1400px] mx-auto px-6 md:px-12 lg:px-24 py-12">
    <h1 class="text-3xl font-bold mb-8 text-center">Compare Phones</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
        <!-- Phone 1 Selector -->
        <div class="p-6 border border-gray-200 rounded-xl">
            <label class="block text-sm font-medium text-gray-700 mb-2">Select Phone 1</label>
            <select id="phone1-select"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent">
                <option value="">Choose a phone...</option>
                {% for phone in phones %}
                <option value="{{ phone.id }}">{{ phone.brand }} {{ phone.model }}</option>
                {% endfor %}
            </select>
            <div id="phone1-preview" class="mt-6 hidden text-center">
                <!-- Preview populated by JS -->
            </div>
        </div>

        <!-- Phone 2 Selector -->
        <div class="p-6 border border-gray-200 rounded-xl">
            <label class="block text-sm font-medium text-gray-700 mb-2">Select Phone 2</label>
            <select id="phone2-select"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent">
                <option value="">Choose a phone...</option>
                {% for phone in phones %}
                <option value="{{ phone.id }}">{{ phone.brand }} {{ phone.model }}</option>
                {% endfor %}
            </select>
            <div id="phone2-preview" class="mt-6 hidden text-center">
                <!-- Preview populated by JS -->
            </div>
        </div>
    </div>

    <!-- Comparison Table -->
    <div id="comparison-table" class="hidden overflow-x-auto">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-50">
                    <th class="p-4 border border-gray-200 w-1/3">Feature</th>
                    <th class="p-4 border border-gray-200 w-1/3" id="th-phone1">Phone 1</th>
                    <th class="p-4 border border-gray-200 w-1/3" id="th-phone2">Phone 2</th>
                </tr>
            </thead>
            <tbody id="comparison-body">
                <!-- Rows populated by JS -->
            </tbody>
        </table>
    </div>
</div>

<script>
    const phones = {{ phones_json| safe }};

    const phone1Select = document.getElementById('phone1-select');
    const phone2Select = document.getElementById('phone2-select');
    const comparisonTable = document.getElementById('comparison-table');
    const comparisonBody = document.getElementById('comparison-body');

    function updateComparison() {
        const p1Id = phone1Select.value;
        const p2Id = phone2Select.value;

        if (p1Id && p2Id) {
            const p1 = phones[p1Id];
            const p2 = phones[p2Id];

            document.getElementById('th-phone1').textContent = p1.model;
            document.getElementById('th-phone2').textContent = p2.model;

            // Generate rows
            let html = '';

            // Price
            html += `
                <tr>
                    <td class="p-4 border border-gray-200 font-medium">Price (Amazon)</td>
                    <td class="p-4 border border-gray-200">₹${p1.prices.amazon}</td>
                    <td class="p-4 border border-gray-200">₹${p2.prices.amazon}</td>
                </tr>
            `;

            // Specs
            const allKeys = new Set([...Object.keys(p1.specs), ...Object.keys(p2.specs)]);
            allKeys.forEach(key => {
                html += `
                    <tr>
                        <td class="p-4 border border-gray-200 font-medium capitalize">${key.replace(/_/g, ' ')}</td>
                        <td class="p-4 border border-gray-200">${p1.specs[key] || '-'}</td>
                        <td class="p-4 border border-gray-200">${p2.specs[key] || '-'}</td>
                    </tr>
                `;
            });

            comparisonBody.innerHTML = html;
            comparisonTable.classList.remove('hidden');
        } else {
            comparisonTable.classList.add('hidden');
        }
    }

    phone1Select.addEventListener('change', updateComparison);
    phone2Select.addEventListener('change', updateComparison);
</script>
{% endblock %}